"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[954],{6744:function(e,n,t){t.d(n,{A:function(){return i}});var o=t(4116),s=t(6156);function i(e){if(console.log("calling"),!e)return null;const n=o.c9.fromISO(e,{zone:(0,s.A)()}),t=n.toSeconds();return console.log("date to unix: ",t),t}},2068:function(e,n,t){t.d(n,{A:function(){return i}});var o=t(7165),s=t(7414);async function i(e,n,t){try{try{e=(0,s.l)(e,"CA").number,console.log("phoneNum: ",e)}catch(i){return{message:"Invalid phone number"}}const a="",c=await fetch(`${a}/api/authentication/log_in`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_num:e,password:n,remember_me:t})}),l=await c.json();if(c.ok){const e=(0,o.je)();return e.setMyProfile({token:l.token,role:l.user_role}),!0}return console.log("Failed to log in, message: ",l.message),{message:l.message}}catch(i){return console.error("Unexpected Error: ",i),{message:"Unexpected Error"}}}},4954:function(e,n,t){t.r(n),t.d(n,{default:function(){return Jn}});var o=t(6768),s=t(5130);const i={id:"layout"},a={key:0};function c(e,n,t,c,l,r){const u=(0,o.g2)("WelcomeModal"),d=(0,o.g2)("Services"),v=(0,o.g2)("SelectTime"),p=(0,o.g2)("FinalPreview"),m=(0,o.g2)("BookingConfirmation");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(u),(0,o.bo)((0,o.Lk)("div",null,[(0,o.bF)(d,{getServices:c.getServices,onNavigateNext:c.onNavigateNext,resetPage2:c.resetPage2},null,8,["getServices","onNavigateNext","resetPage2"])],512),[[s.aG,1==c.page||0==c.page]]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:c.page2trigger},[(0,o.bF)(v,{isReady:2==c.page,services:c.services,onSelectChain:c.onSelectChain,onReturn:c.onReturn},null,8,["isReady","services","onSelectChain","onReturn"])])),[[s.aG,2==c.page]]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:c.page3trigger},[(0,o.bF)(p,{chain:c.chain,date:c.date,onInputMessage:c.onInputMessage,onSubmit:c.onSubmit,onReturn:c.onReturn},null,8,["chain","date","onInputMessage","onSubmit","onReturn"])])),[[s.aG,3==c.page]]),4==c.page?((0,o.uX)(),(0,o.CE)("div",a,[(0,o.bF)(m,{chain:c.chain,date:c.date,onClearForm:c.onClearForm,customer:c.customer},null,8,["chain","date","onClearForm","customer"])])):(0,o.Q3)("",!0)])}t(4114);var l=t(144),r=t(1387);const u={id:"flexBox"},d={id:"duo"};function v(e,n,t,i,a,c){const l=(0,o.g2)("Service"),r=(0,o.g2)("FontAwesomeIcon"),v=(0,o.g2)("SelectService");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bo)((0,o.Lk)("div",u,[n[4]||(n[4]=(0,o.Lk)("div",{id:"note"},"Step 2: Use checkboxes to select technicians",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.services,((e,n)=>((0,o.uX)(),(0,o.Wv)(l,{key:n,service:e,onRemoveService:i.onRemoveService,onInputEmpIds:i.onInputEmpIds},null,8,["service","onRemoveService","onInputEmpIds"])))),128)),n[5]||(n[5]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("button",{class:"greenBtn",id:"addBtn",onClick:n[0]||(n[0]=(...e)=>i.openSelect&&i.openSelect(...e))},[(0,o.bF)(r,{icon:i.addIcon},null,8,["icon"]),n[2]||(n[2]=(0,o.eW)(" Add Service "))]),n[6]||(n[6]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("div",d,[(0,o.Lk)("button",{class:"blueBtn",id:"rightBtn",onClick:n[1]||(n[1]=(...e)=>i.onSubmit&&i.onSubmit(...e))},[n[3]||(n[3]=(0,o.eW)(" Continue ")),(0,o.bF)(r,{icon:i.continueIcon},null,8,["icon"])])])],512),[[s.aG,!i.isSelecting]]),(0,o.bo)((0,o.Lk)("div",null,[(0,o.bF)(v,{onInputService:i.onInputService,onClose:i.closeSelect,isReturnable:i.isReturnable},null,8,["onInputService","onClose","isReturnable"])],512),[[s.aG,i.isSelecting]])],64)}var p=t(8249),m=t(2353);const h={key:0,id:"flexBox"},g={key:1};function k(e,n,t,s,i,a){const c=(0,o.g2)("FontAwesomeIcon"),l=(0,o.g2)("Category"),r=(0,o.g2)("SelectAOSOs");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",null,[t.isReturnable?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"orangeBtn",id:"backBtn",onClick:n[0]||(n[0]=(...e)=>a.closeSelect&&a.closeSelect(...e))},[(0,o.bF)(c,{icon:i.backIcon},null,8,["icon"]),n[1]||(n[1]=(0,o.eW)(" Back "))])):(0,o.Q3)("",!0)]),n[2]||(n[2]=(0,o.Lk)("div",{id:"note"},[(0,o.eW)(" Note: this website is intended for individual appointments "),(0,o.Lk)("br"),(0,o.eW)(" Step 1: Select your service ")],-1)),i.isFetched?((0,o.uX)(),(0,o.CE)("div",h,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.categories,((e,n)=>((0,o.uX)(),(0,o.Wv)(l,{key:n,category:e,onInputServiceId:a.onInputServiceId},null,8,["category","onInputServiceId"])))),128))])):(0,o.Q3)("",!0),i.openAOSs?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.bF)(r,{serviceId:i.serviceId,onClose:a.closeAOSOs,onInputAOSOs:a.onInputAOSOs},null,8,["serviceId","onClose","onInputAOSOs"])])):(0,o.Q3)("",!0)],64)}var f=t(4232);const b={key:0,id:"category"},I={id:"title"},y=["onClick"],S={key:0};function C(e,n,t,s,i,a){return t.category.services.length?((0,o.uX)(),(0,o.CE)("div",b,[(0,o.Lk)("div",I,(0,f.v_)(t.category.cate_name),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.category.services,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{id:"service",key:n,onClick:n=>a.onSelectService(e.service_id,e.service_name)},[(0,o.Lk)("div",null,(0,f.v_)(e.service_name),1),e.price?((0,o.uX)(),(0,o.CE)("div",S,"$ "+(0,f.v_)(e.price)+" +",1)):(0,o.Q3)("",!0)],8,y)))),128))])):(0,o.Q3)("",!0)}var _=t(1076),E={name:"Category-",props:{category:Object,onInputServiceId:Function},methods:{formatDate(e){return(0,_.A)(e)},onSelectService(e,n){this.onInputServiceId(e,n)}}},L=t(1241);const w=(0,L.A)(E,[["render",C],["__scopeId","data-v-97f2fcee"]]);var F=w,O=(t(8992),t(3949),t(445)),A=t(8199);async function R(){try{const e="",n=await fetch(`${e}/api/services/get_services/${(0,O.A)()}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),t=await n.json();if(n.ok){const e=x(t.services,t.categories);return e}(0,A.A)(t.message),console.log("Failed to fetch employee list, message: ",t.message)}catch(e){console.error("Unexpected Error: ",e)}}function x(e,n){const t={null:{cate_id:null,cate_name:"Others",services:[]}};n.forEach((e=>{const[n,o]=e;t[n]={cate_id:n,cate_name:o,services:[]}})),e.forEach((e=>{const[n,o,s,i,a,c]=e;i&&t[a].services.push({service_id:n,service_name:o,last_date:s,price:c})})),!t[null].services.length>0&&delete t[null];const o=Object.values(t).sort(((e,n)=>n.services.length-e.services.length));return o}const N={id:"parent"},X={id:"window"},B={key:0},j={id:"title"},T={id:"description"},K={class:"question"},D={class:"optionBox"},M=["value","onUpdate:modelValue"],P={key:0,id:"msg"},W={key:1,id:"notAvail"};function $(e,n,t,i,a,c){const l=(0,o.g2)("FontAwesomeIcon");return(0,o.uX)(),(0,o.CE)("div",N,[(0,o.Lk)("div",{id:"background",onClick:n[0]||(n[0]=(...e)=>c.handleClose&&c.handleClose(...e))}),(0,o.Lk)("div",X,[(0,o.Lk)("button",{onClick:n[1]||(n[1]=(...e)=>c.handleClose&&c.handleClose(...e)),id:"closeBtn",class:"redBtn"},[(0,o.bF)(l,{icon:a.faXmark},null,8,["icon"])]),a.fetched?((0,o.uX)(),(0,o.CE)("div",B,[(0,o.Lk)("div",j,[(0,o.eW)((0,f.v_)(a.serviceInfo.name)+" ",1),(0,o.Lk)("div",T,(0,f.v_)(a.serviceInfo.description),1)]),a.serviceInfo.client_can_book?((0,o.uX)(),(0,o.CE)("form",{key:0,onSubmit:n[2]||(n[2]=(0,s.D$)(((...e)=>c.onSubmit&&c.onSubmit(...e)),["prevent"])),id:"content"},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.questions,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n,class:"questionBox"},[(0,o.Lk)("span",K,(0,f.v_)(n+1)+". "+(0,f.v_)(e.questionText),1),(0,o.Lk)("div",D,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.options,((n,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"options"},[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"radio",value:n.optionId,"onUpdate:modelValue":n=>a.answers[e.questionId]=n,required:""},null,8,M),[[s.XL,a.answers[e.questionId]]]),(0,o.eW)(" "+(0,f.v_)(n.optionText)+" "+(0,f.v_)(c.formatOffset(n.optionOffset)),1)])])))),128))])])))),128)),a.msg?((0,o.uX)(),(0,o.CE)("div",P,(0,f.v_)(a.msg),1)):(0,o.Q3)("",!0),n[3]||(n[3]=(0,o.Lk)("div",{id:"btnBox"},[(0,o.Lk)("button",{id:"confirm",class:"blueBtn"},"Confirm")],-1))],32)):((0,o.uX)(),(0,o.CE)("div",W," This service is not available for online booking, please contact us to book "))])):(0,o.Q3)("",!0)])])}async function q(e){try{const n="",t=await fetch(`${n}/api/services/get_add_on_services/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),o=await t.json();if(t.ok){const e=U(o.add_on_services),n=Q(o.service_info);return{questions:e,serviceInfo:n}}(0,A.A)(o.message),console.log("Failed to fetch add-on services, message: ",o.message)}catch(n){console.error("Unexpected Error: ",n)}}function U(e){let n=[],t=-1,o=null;for(let s of e){const[e,i,a,c,l]=s;if(o!==c){const e={questionId:c,questionText:l,options:[]};n.push(e),o=c,t++}const r={optionId:e,optionText:i,optionOffset:a};n[t].options.push(r)}return n}function Q(e){const[n,t,o,s,i]=e;return{name:n,description:t,duration:o,price:s,client_can_book:i}}var J={props:{serviceId:Number,onClose:Function,onInputAOSOs:Function},data(){return{faXmark:m.Jyw,questions:[],serviceInfo:{},msg:"",answers:{},fetched:!1}},components:{FontAwesomeIcon:p.gc},methods:{onSubmit(){const e=[];for(let n in this.answers)e.push(Number(n)),e.push(this.answers[n]);e.length/2===this.questions.length?(this.onInputAOSOs(e),this.onClose()):this.msg="Please provide answers to all questions"},handleClose(){this.onClose()},formatOffset(e){if(0===e)return;let n=e>=0?"+":"-",t=Math.abs(Math.floor(e/60));return`(${n}${t} mins)`},onInputAnswer(){}},async created(){const{questions:e,serviceInfo:n}=await q(this.serviceId);this.questions=e,this.serviceInfo=n,this.fetched=!0}};const V=(0,L.A)(J,[["render",$],["__scopeId","data-v-23738a09"]]);var G=V,H={props:{isReturnable:Boolean,onInputService:Function,onClose:Function},components:{FontAwesomeIcon:p.gc,Category:F,SelectAOSOs:G},data(){return{backIcon:m.NDX,isFetched:!1,openAOSs:!1,categories:[],serviceId:null,serviceName:""}},methods:{closeSelect(){this.onClose()},onInputServiceId(e,n){this.serviceId=e,this.serviceName=n,this.openAOSs=!0},closeAOSOs(){this.openAOSs=!1},onInputAOSOs(e){this.onInputService(this.serviceId,e,this.serviceName)}},async created(){this.categories=await R(),this.isFetched=!0}};const Y=(0,L.A)(H,[["render",k],["__scopeId","data-v-7143514d"]]);var z=Y;const Z={id:"bar"},ee={id:"card"},ne={id:"name"},te={id:"des"},oe={key:0,id:"technicians"},se=["value"],ie={key:1,id:"note"};function ae(e,n,t,i,a,c){const l=(0,o.g2)("FontAwesomeIcon");return(0,o.uX)(),(0,o.CE)("div",Z,[(0,o.Lk)("div",ee,[(0,o.Lk)("div",ne,(0,f.v_)(a.name),1),(0,o.Lk)("div",te,(0,f.v_)(a.description),1),n[3]||(n[3]=(0,o.Lk)("br",null,null,-1)),a.SEs.length&&a.fetched?((0,o.uX)(),(0,o.CE)("div",oe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.SEs,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.employee_id},[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{id:"check",type:"checkbox",value:{id:e.employee_id,alias:e.alias},"onUpdate:modelValue":n[0]||(n[0]=e=>a.checked=e),onChange:n[1]||(n[1]=(...e)=>c.onCheckEmp&&c.onCheckEmp(...e))},null,40,se),[[s.lH,a.checked]]),(0,o.bF)(l,{icon:a.userIcon},null,8,["icon"]),(0,o.eW)(" "+(0,f.v_)(e.alias),1)])])))),128))])):((0,o.uX)(),(0,o.CE)("div",ie," No available technicians right now, please deselect this service "))]),(0,o.Lk)("div",null,[(0,o.Lk)("button",{class:"redBtn",id:"remove",onClick:n[2]||(n[2]=e=>c.onRemove(t.service.serviceId))},[(0,o.bF)(l,{icon:a.removeIcon},null,8,["icon"])])])])}t(1454);var ce=t(92);async function le(e){try{const n="",t=await fetch(`${n}/api/services/get_service_preview/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),o=await t.json();if(t.ok){const e=o.preview,[,n,t,,s,i,a,c,l]=e,r={name:n,description:t,cate_id:s,cate_name:i,length:a,price:c,client_can_book:l};return r}(0,A.A)(o.message),console.log("Failed to fetch service preview, message: ",o.message)}catch(n){console.error("Unexpected Error: ",n)}}async function re(e,n=(0,O.A)()){try{const t="",o=await fetch(`${t}/api/services/get_service_employees/${e}/${n}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),s=await o.json();if(o.ok){const e=s.employees,n=[];return e.forEach((e=>{const[t,o,s,i]=e;if(i){const e={employee_id:t,alias:o,service_id:i,last_date:s};n.push(e)}})),n}(0,A.A)(s.message),console.log("Failed to fetch service's employees, message: ",s.message)}catch(t){console.error("Unexpected Error: ",t)}}var ue={name:"Service-",props:{service:Object,onRemoveService:Function,onInputEmpIds:Function},components:{FontAwesomeIcon:p.gc},data(){return{timeIcon:m.a$,dollarIcon:m.Vpi,removeIcon:m.sjs,userIcon:ce.X46,fetched:!1,SEs:[],checked:[],name:"",description:"",length:"",price:null}},methods:{onRemove(e){this.onRemoveService(e)},onCheckEmp(){this.onInputEmpIds(this.service.serviceId,this.checked.map((e=>e.id)),this.checked.map((e=>e.alias)))}},async created(){const[e,n]=await Promise.all([le(this.service.serviceId),re(this.service.serviceId)]);this.name=e.name,this.description=e.description,this.length=e.length,this.price=e.price,this.SEs=n,this.max=n.length,this.checked=n.map((e=>({id:e.employee_id,alias:e.alias}))),this.onCheckEmp(),this.fetched=!0}};const de=(0,L.A)(ue,[["render",ae],["__scopeId","data-v-2c133d12"]]);var ve=de,pe={name:"BookNowParent",components:{SelectService:z,Service:ve,FontAwesomeIcon:p.gc},props:{getServices:Function,onNavigateNext:Function,resetPage2:Function},setup(e){const n=m.QLR,t=m.NDX,s=m.MjS,i=(0,r.rd)(),a=(0,r.lq)(),c=(0,l.KR)(!1),u=(0,l.KR)(!1),d=(0,l.KR)({}),v=(n,t,o)=>{d.value[n]||(d.value[n]={serviceId:n,empIds:[],AOSOs:t,serviceName:o}),u.value=!0,c.value=!1,i.push("/booknow/1"),e.resetPage2()},p=()=>{c.value=!0,i.push("/booknow/0")},h=()=>{i.back()},g=n=>{delete d.value[n],e.resetPage2()},k=(n,t,o)=>{d.value[n].empIds=t,d.value[n].empAliases=o,e.resetPage2()},f=()=>{Object.keys(d.value).length?e.onNavigateNext():c.value=!0};return(0,o.sV)((()=>{d.value=e.getServices(),Object.keys(d.value).length||(c.value=!0)})),(0,o.wB)((()=>a.params.page),(e=>{1!=e?0!=e||(c.value=!0):c.value=!1})),{addIcon:n,backIcon:t,continueIcon:s,isSelecting:c,isReturnable:u,services:d,onInputService:v,openSelect:p,closeSelect:h,onRemoveService:g,onInputEmpIds:k,onSubmit:f}}};const me=(0,L.A)(pe,[["render",v],["__scopeId","data-v-12274b94"]]);var he=me;const ge={class:"flexBox"},ke={class:"top"},fe=["value"],be={key:0},Ie={key:1},ye={id:"openingBox"},Se={key:0},Ce={key:1},_e=["onClick"],Ee={key:0,id:"msg"},Le={id:"duo"};function we(e,n,t,s,i,a){const c=(0,o.g2)("FontAwesomeIcon");return(0,o.uX)(),(0,o.CE)(o.FK,null,[n[7]||(n[7]=(0,o.Lk)("div",{id:"note"},"Step 3: Select date and time",-1)),(0,o.Lk)("div",ge,[(0,o.Lk)("div",ke,[(0,o.Lk)("button",{class:"dayBtn",onClick:n[0]||(n[0]=e=>a.onMoveDate(-1))},[(0,o.bF)(c,{icon:i.faMinus},null,8,["icon"])]),(0,o.Lk)("div",null,[(0,o.Lk)("input",{id:"date",type:"date",ref:"dateInput",value:i.date,onChange:n[1]||(n[1]=e=>a.onInputDate(e.target.value))},null,40,fe)]),(0,o.Lk)("button",{class:"dayBtn",onClick:n[2]||(n[2]=e=>a.onMoveDate(1))},[(0,o.bF)(c,{icon:i.faPlus},null,8,["icon"])])]),i.unixDate?((0,o.uX)(),(0,o.CE)("div",be,(0,f.v_)(a.unixToReadable(i.unixDate)),1)):(0,o.Q3)("",!0),i.unixDate?((0,o.uX)(),(0,o.CE)("div",Ie,(0,f.v_)(a.unixTimeToReminder(i.unixDate)),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ye,[i.date?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",Se,"Input a date to continue")),i.fetched&&!i.sortedOpenings.length?((0,o.uX)(),(0,o.CE)("div",Ce," No open slots on this dateðŸ¥² ")):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.sortedOpenings,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n},[(0,o.Lk)("button",{class:"openings",onClick:n=>a.onChooseOpening(e)},[(0,o.Lk)("div",null,(0,f.v_)(a.formatTime(e.start)),1)],8,_e)])))),128))]),i.msg?((0,o.uX)(),(0,o.CE)("div",Ee,(0,f.v_)(i.msg),1)):(0,o.Q3)("",!0),(0,o.Lk)("div",Le,[(0,o.Lk)("button",{class:"orangeBtn",id:"leftBtn",onClick:n[3]||(n[3]=(...e)=>a.onBack&&a.onBack(...e))},[(0,o.bF)(c,{icon:i.backIcon},null,8,["icon"]),n[5]||(n[5]=(0,o.eW)(" Back "))]),(0,o.Lk)("button",{class:"blueBtn",id:"rightBtn",onClick:n[4]||(n[4]=(...e)=>a.onContinue&&a.onContinue(...e))},[n[6]||(n[6]=(0,o.eW)(" Continue ")),(0,o.bF)(c,{icon:i.continueIcon},null,8,["icon"])])])],64)}function Fe(e){if(isNaN(e)||e<0)return;const n=Math.floor(e/3600)%24,t=Math.floor(e%3600/60),o=n>=12?"PM":"AM",s=n%12===0?12:n%12;return`${String(s)}:${String(t).padStart(2,"0")} ${o}`}var Oe=t(6744),Ae=t(3519);async function Re(e,n){try{console.log("services",n);const t=Object.values(n).map((({empIds:n,serviceId:t,AOSOs:o})=>({employee_ids:n,service_id:t,selected_AOSO:o,date:e}))),o="",s=await fetch(`${o}/api/appointments/get_availability_list`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({DELAs_requests:t})}),i=await s.json();if(s.ok){console.log("json.DELAs_list: ",i.DELAs_list);const e=xe(i.DELAs_list);console.log("serviceSlots: ",e);const o=Ne(e,n),s=Be(o,t.length);return console.log("chains: ",s),s}(0,A.A)(i.message),console.log("Failed to fetch availabilities, message: ",i.message)}catch(t){console.error("Unexpected Error: ",t)}}function xe(e){console.log("DELAs_list: ",e);let n=[];return e.forEach((e=>{const t={serviceId:null,slots:[]},o=new Map,{service_id:s,values:i}=e;t.serviceId=s,i.forEach((e=>{const{employee_id:n,length:t,slots:s}=e;s.forEach((e=>{const s=e,i=s+t;if(o.has(s)||o.set(s,new Map),!o.get(s).has(i)){const e={start:s,end:i,empIds:[]};o.get(s).set(i,e)}o.get(s).get(i).empIds.push(n)}))})),o.forEach((e=>{e.forEach((e=>{t.slots.push(e)}))})),n.push(t)})),n}function Ne(e,n){let t=[];if(e.length>1)return e.forEach(((o,s)=>{const{serviceId:i,slots:a}=o;a.forEach((e=>{e.serviceId=i,e.AOSOs=n[i].AOSOs,e.serviceName=n[i].serviceName,e.empAliases=n[i].empAliases}));const c=[...e.slice(0,s),...e.slice(s+1)];let l=Ne(c,n);l=Xe(l,a),t=t.concat(l)})),t;const o=e[0],{serviceId:s,slots:i}=o;return i.forEach((e=>{e.serviceId=s,e.AOSOs=n[s].AOSOs,e.serviceName=n[s].serviceName,e.empAliases=n[s].empAliases;let o={chainStart:e.start,chainEnd:e.end,minEnd:e.end,slots:[e]};t.push(o)})),t}function Xe(e,n){for(const t of e)for(const e of n){const n=t.chainEnd;if(e.start===n){t.slots.push(e),t.chainEnd=e.end,t.minEnd+=e.end-e.start;break}}return e}function Be(e,n){let t=[];return e.forEach((e=>{e.slots.length===n&&t.push(e)})),t}var je={props:{isReady:Boolean,services:Object,onSelectChain:Function,onReturn:Function},components:{FontAwesomeIcon:p.gc},data(){return{backIcon:m.NDX,continueIcon:m.MjS,faPlus:m.QLR,faMinus:m.EZy,fetched:!1,msg:"",chains:[],openings:{},sortedOpenings:[],date:null,chain:null,unixDate:null}},methods:{onBack(){this.onReturn()},onContinue(){this.unixDate?this.chain?this.onSelectChain(this.chain,this.unixDate):this.msg="You haven't chosen a time slot for your appointment":this.msg="You haven't chosen a date"},formatTime(e){return Fe(e)},onChooseOpening(e){this.msg="",this.chain=null;const n=e.chains.length,t=Math.floor(Math.random()*n);this.chain=e.chains[t],this.onContinue()},isInThePast(e){const n=(0,O.A)(),t=(0,Oe.A)(e),o=t<=n-86400;return o},resetData(){this.msg="",this.chains=[],this.openings={},this.sortedOpenings=[],this.date=null,this.chain=null,this.unixDate=null},async onInputDate(e){this.fetched=!1,this.resetData(),this.isInThePast(e)||(this.date=e,this.unixDate=(0,Oe.A)(e),console.log("unix date: ",this.unixDate),await this.fetchData())},async onMoveDate(e){let n;if(this.date)n=new Date(this.date);else{const e=new Date,t=e.getTimezoneOffset();n=new Date(e.getTime()-60*t*1e3)}n.setDate(n.getDate()+e);const t=n.toISOString().slice(0,10);await this.onInputDate(t)},async fetchData(){if(!this.services)return;const e=await Re(this.unixDate,this.services);if(!e)return;this.chains=e;for(let t of this.chains){const e=t.chainStart,n=t.chainEnd,o=t.minEnd;if(!this.openings[e]||this.openings[e].end>n){const t={start:e,end:n,minEnd:o,chains:[]};this.openings[e]=t}this.openings[e].end===n&&this.openings[e].chains.push(t)}const n=Object.values(this.openings);this.sortedOpenings=n.sort(((e,n)=>e.start-n.start)),this.fetched=!0},unixTimeToReminder:Ae.A,unixToReadable:_.A},watch:{isReady(e){e&&!this.date&&this.onMoveDate(1)}}};const Te=(0,L.A)(je,[["render",we],["__scopeId","data-v-84d4d646"]]);var Ke=Te,De=t(6769),Me=t(7414);async function Pe(e){try{try{e=(0,Me.l)(e,"CA").number}catch(n){return{message:"Invalid phone number"}}const t="",o=await fetch(`${t}/api/authentication/request_otp`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_num:e})}),s=await o.json(),i=s.code_id,a=s.message,c=s.wait_time;return{codeId:i,message:a,waitTime:c}}catch(n){return console.error("Unexpected Error: ",n),{message:"Unexpected Error"}}}const We={id:"msg"};var $e={__name:"PhoneNumInput",props:{onNext:Function},setup(e){const n=e,t=(0,l.KR)(""),i=(0,l.KR)(""),a=(0,l.KR)("");async function c(){const{codeId:e,message:o,waitTime:s}=await Pe(t.value);e?n.onNext(e,t.value,i.value,s):a.value=o}return(e,n)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[n[3]||(n[3]=(0,o.Lk)("div",{id:"title"},"Please leave your phone number to confirm appointment",-1)),(0,o.Lk)("form",{onSubmit:(0,s.D$)(c,["prevent"])},[(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{type:"tel","onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),placeholder:"Phone Number",required:""},null,512),[[s.Jo,t.value]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=e=>i.value=e),placeholder:"Name",required:""},null,512),[[s.Jo,i.value]])]),(0,o.Lk)("div",We,(0,f.v_)(a.value),1),n[2]||(n[2]=(0,o.Lk)("button",{class:"blueBtn"},"Send Verification Code",-1))],32)],64))}};const qe=(0,L.A)($e,[["__scopeId","data-v-a752789e"]]);var Ue=qe;async function Qe(e,n,t,o,s){try{const i=Je(t);console.log("new slots:",i),console.log("date",o);const a="",c=await fetch(`${a}/api/appointments/guest_add_appo`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({otp_id:e,otp:n,slots:i,date:o,name:s})}),l=await c.json();return c.ok||console.log("Failed to add appointments as guest, message: ",l.message),{ok:c.ok,message:l.message,customer:{name:l.client_name,phoneNum:l.phone_num}}}catch(i){console.error("Unexpected Error: ",i)}}function Je(e){const n={},{slots:t}=e;for(const s of t){const{empIds:e}=s;for(const t of e)n[t]||(n[t]=0),n[t]++}const o=[];for(const s of t){const{start:e,end:t,empIds:i,serviceId:a,AOSOs:c,message:l}=s;i.sort(((e,t)=>-(n[e]-n[t])));const r=i[0],u=n[r];console.log("empIds: ",JSON.stringify(i));let d=i;for(let o=0;o<i.length;o++){const e=i[o];if(n[e]<u){const e=o-1;d=i.slice(0,e);break}}console.log("topEmpIds: ",d);const v=Math.floor(Math.random()*d.length),p={start:e,end:t,empId:d[v],serviceId:a,AOSOs:c,empIds:i,message:l};o.push(p)}return o}const Ve={id:"title"},Ge={id:"msg"},He={key:0,class:"disabled"};var Ye={__name:"OTPverify",props:{codeId:Number,phoneNum:String,chain:Object,date:Number,name:String,onSubmit:Function,waitTime:Number},setup(e){const n=e,t=(0,l.KR)(n.waitTime),i=(0,l.KR)(n.codeId),a=(0,l.KR)(""),c=(0,l.KR)("");async function r(){const{ok:e,message:t,customer:o}=await Qe(i.value,a.value,n.chain,n.date,n.name);if(!e)return c.value=t,void(a.value="");n.onSubmit(o.name,o.phoneNum)}async function u(){const{codeId:e,message:o,waitTime:s}=await Pe(n.phoneNum);e?(i.value=e,t.value=s):c.value=o}let d;return(0,o.sV)((()=>{d=setInterval((()=>{t.value--}),1e3)})),(0,o.hi)((()=>{clearInterval(d)})),(n,i)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",Ve," Please enter the one time code sent to "+(0,f.v_)(e.phoneNum)+" by text ",1),(0,o.Lk)("form",{onSubmit:(0,s.D$)(r,["prevent"])},[(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=e=>a.value=e),placeholder:"Verification Code"},null,512),[[s.Jo,a.value]])]),(0,o.Lk)("div",Ge,(0,f.v_)(c.value),1),i[1]||(i[1]=(0,o.Lk)("button",{class:"greenBtn"},"Verify",-1)),t.value>0?((0,o.uX)(),(0,o.CE)("a",He," Resend Code (Wait "+(0,f.v_)(t.value)+"s)",1)):((0,o.uX)(),(0,o.CE)("a",{key:1,onClick:u}," Resend Code "))],32)],64))}};const ze=(0,L.A)(Ye,[["__scopeId","data-v-5ab81cbb"]]);var Ze=ze;const en={id:"parent"},nn={id:"window"},tn={id:"content"},on={key:0},sn={key:1},an={};var cn=Object.assign(an,{__name:"GuestBooking",props:{chain:Object,date:Number,onClose:Function,onSubmit:Function},setup(e){const n=e,t=(0,l.KR)(1),s=(0,l.KR)(0),i=(0,l.KR)(),a=(0,l.KR)(""),c=(0,l.KR)("");function r(e,n,o,l){i.value=e,a.value=n,s.value=l,c.value=o,t.value++}return(u,d)=>((0,o.uX)(),(0,o.CE)("div",en,[d[1]||(d[1]=(0,o.Lk)("div",{id:"background"},null,-1)),(0,o.Lk)("div",nn,[(0,o.Lk)("button",{onClick:d[0]||(d[0]=e=>n.onClose()),id:"closeBtn",class:"redBtn"},[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(m.Jyw)},null,8,["icon"])]),(0,o.Lk)("div",tn,[1===t.value?((0,o.uX)(),(0,o.CE)("div",on,[(0,o.bF)(Ue,{onNext:r})])):(0,o.Q3)("",!0),2===t.value?((0,o.uX)(),(0,o.CE)("div",sn,[(0,o.bF)(Ze,{codeId:i.value,phoneNum:a.value,chain:n.chain,date:n.date,name:c.value,onSubmit:e.onSubmit,waitTime:s.value},null,8,["codeId","phoneNum","chain","date","name","onSubmit","waitTime"])])):(0,o.Q3)("",!0)])])]))}});const ln=(0,L.A)(cn,[["__scopeId","data-v-99c05362"]]);var rn=ln;async function un(e,n){try{const t=dn(e);console.log("new slots:",t),console.log("date",n);const o="",s=await fetch(`${o}/api/appointments/client_add_appo`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({slots:t,date:n})}),i=await s.json();if(s.ok){const e={name:i.client_name,phoneNum:i.phone_num};return console.log("customer",e),{customer:e}}(0,A.A)(i.message),console.log("Failed to add appointments as client, message: ",i.message)}catch(t){console.error("Unexpected Error: ",t)}}function dn(e){const n={},{slots:t}=e;for(const s of t){const{empIds:e}=s;for(const t of e)n[t]||(n[t]=0),n[t]++}const o=[];for(const s of t){const{start:e,end:t,empIds:i,serviceId:a,AOSOs:c,message:l}=s;i.sort(((e,t)=>-(n[e]-n[t])));const r=i[0],u=n[r];console.log("empIds: ",JSON.stringify(i));let d=i;for(let o=0;o<i.length;o++){const e=i[o];if(n[e]<u){d=i.slice(0,o);break}}console.log("topEmpIds: ",d);const v=Math.floor(Math.random()*d.length),p={start:e,end:t,empId:d[v],serviceId:a,AOSOs:c,empIds:i,message:l};o.push(p)}return o}var vn=t(7165);const pn={id:"flexBox"},mn={id:"date"},hn={class:"service"},gn=["value","onInput"],kn={id:"duo"},fn={name:"FinalPreview"};var bn=Object.assign(fn,{props:{chain:Object,date:Number,onInputMessage:Function,onSubmit:Function,onReturn:Function},setup(e){const n=e,t=m.NDX,s=m.e68,i=(0,l.KR)([]),a=(0,vn.je)(),c=(0,o.EW)((()=>a.token)),r=(0,l.KR)(!1);function u(e,t){const o=t.target.value;o.length&&(n.onInputMessage(e,o),v(e))}async function d(){if(!c.value)return void(r.value=!0);const e=await un(n.chain,n.date);e&&n.onSubmit(e.customer.name,e.customer.phoneNum)}function v(e){const n=i.value?.[e];n&&(n.style.height="auto",n.style.height=n.scrollHeight+2+"px")}return(i,a)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",pn,[a[1]||(a[1]=(0,o.Lk)("div",{id:"note"},"Step 4: Review your selections",-1)),(0,o.Lk)("div",mn,(0,f.v_)((0,l.R1)(_.A)(e.date))+" ("+(0,f.v_)((0,l.R1)(Ae.A)(e.date))+") ",1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.chain.slots,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{class:"slot",key:n},[(0,o.Lk)("div",hn,(0,f.v_)(e.serviceName),1),(0,o.Lk)("div",null,[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(m.a$)},null,8,["icon"]),(0,o.eW)(" "+(0,f.v_)((0,l.R1)(De.A)(e.start))+" to "+(0,f.v_)((0,l.R1)(De.A)(e.end)),1)]),(0,o.Lk)("div",null,[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(ce.X46)},null,8,["icon"]),(0,o.eW)(" "+(0,f.v_)(e.empAliases.join(" / ")),1)]),(0,o.Lk)("div",null,[(0,o.Lk)("textarea",{ref_for:!0,ref:"textareas",rows:"3",placeholder:"(Optional) Message to technician...",value:e.message,onInput:e=>u(n,e)},null,40,gn)])])))),128))]),(0,o.Lk)("div",kn,[(0,o.Lk)("button",{class:"orangeBtn",id:"leftBtn",onClick:a[0]||(a[0]=(...n)=>e.onReturn&&e.onReturn(...n))},[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(t)},null,8,["icon"]),a[2]||(a[2]=(0,o.eW)(" Back "))]),(0,o.Lk)("button",{class:"greenBtn",id:"rightBtn",onClick:d},[a[3]||(a[3]=(0,o.eW)(" Submit ")),(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(s)},null,8,["icon"])])]),r.value?((0,o.uX)(),(0,o.Wv)(rn,{key:0,chain:n.chain,date:n.date,onSubmit:n.onSubmit,onClose:()=>r.value=!1},null,8,["chain","date","onSubmit","onClose"])):(0,o.Q3)("",!0)],64))}});const In=(0,L.A)(bn,[["__scopeId","data-v-01c09344"]]);var yn=In,Sn=t(4714);const Cn={id:"flexBox"},_n={id:"date"},En={class:"service"},Ln={key:0},wn=["value","onInput"],Fn={};var On=Object.assign(Fn,{__name:"BookingConfirmation",props:{chain:Object,date:Number,onClearForm:Function,customer:Object},setup(e){const n=e,t=(0,l.KR)({}),s=(0,l.KR)(null);return(0,o.sV)((()=>{t.value=n.chain,s.value=n.date,n.onClearForm()})),(n,i)=>((0,o.uX)(),(0,o.CE)("div",Cn,[i[0]||(i[0]=(0,o.Lk)("div",{id:"title"},"Appointment Confirmed â€“ Thank You",-1)),(0,o.Lk)("div",null,"Customer: "+(0,f.v_)((0,l.R1)(Sn.A)(e.customer.phoneNum)),1),(0,o.Lk)("div",_n,(0,f.v_)((0,l.R1)(_.A)(s.value))+" ("+(0,f.v_)((0,l.R1)(Ae.A)(s.value))+") ",1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.value.slots,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"slot",key:t},[(0,o.Lk)("div",En,(0,f.v_)(e.serviceName),1),(0,o.Lk)("div",null,[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(m.a$)},null,8,["icon"]),(0,o.eW)(" "+(0,f.v_)((0,l.R1)(De.A)(e.start))+" to "+(0,f.v_)((0,l.R1)(De.A)(e.end)),1)]),(0,o.Lk)("div",null,[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(ce.X46)},null,8,["icon"]),(0,o.eW)(" "+(0,f.v_)(e.empAliases.join(" / ")),1)]),e.message?((0,o.uX)(),(0,o.CE)("div",Ln,[(0,o.Lk)("textarea",{ref_for:!0,ref:"textareas",rows:"3",value:e.message,onInput:e=>n.onTypeMessage(t,e),disabled:""},null,40,wn)])):(0,o.Q3)("",!0)])))),128)),i[1]||(i[1]=(0,o.Lk)("div",null," If you have any questions or need to reschedule, donâ€™t hesitate to contact us! ",-1))]))}});const An=(0,L.A)(On,[["__scopeId","data-v-07a617b6"]]);var Rn=An,xn=t(2068);const Nn={id:"msg"},Xn={};var Bn=Object.assign(Xn,{__name:"LogInForm",props:{closeModal:Function},setup(e){const n=e,t=(0,l.KR)(""),i=(0,l.KR)(""),a=(0,l.KR)(""),c=(0,l.KR)(!1);async function r(){const{message:e}=await(0,xn.A)(i.value,a.value,c.value);e?t.value=e:n.closeModal()}return(e,n)=>((0,o.uX)(),(0,o.CE)("form",{onSubmit:(0,s.D$)(r,["prevent"])},[(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{type:"tel","onUpdate:modelValue":n[0]||(n[0]=e=>i.value=e),required:"",placeholder:"Phone Number"},null,512),[[s.Jo,i.value]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{type:"password","onUpdate:modelValue":n[1]||(n[1]=e=>a.value=e),required:"",placeholder:"Password"},null,512),[[s.Jo,a.value]])]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{id:"check",type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=e=>c.value=e)},null,512),[[s.lH,c.value]]),n[3]||(n[3]=(0,o.eW)(" Remember me next time "))]),(0,o.Lk)("div",Nn,(0,f.v_)(t.value),1),n[4]||(n[4]=(0,o.Lk)("div",null,[(0,o.Lk)("button",{class:"blueBtn"},"Log in")],-1))],32))}});const jn=(0,L.A)(Bn,[["__scopeId","data-v-1264354e"]]);var Tn=jn;const Kn={key:0,id:"parent"},Dn={id:"window"},Mn={id:"content"},Pn={};var Wn=Object.assign(Pn,{__name:"WelcomeModal",setup(e){const n=(0,l.KR)(!0),t=(0,o.EW)((()=>{const e=null===i.token,n=i.isFetched;return e&&n})),i=(0,vn.je)();function a(){n.value=!1}return(e,i)=>{const c=(0,o.g2)("router-link");return n.value&&t.value?((0,o.uX)(),(0,o.CE)("div",Kn,[i[3]||(i[3]=(0,o.Lk)("div",{id:"background"},null,-1)),(0,o.Lk)("div",Dn,[(0,o.Lk)("button",{onClick:(0,s.D$)(a,["prevent"]),id:"closeBtn",class:"redBtn"},[(0,o.bF)((0,l.R1)(p.gc),{icon:(0,l.R1)(m.Jyw)},null,8,["icon"])]),(0,o.Lk)("div",Mn,[i[2]||(i[2]=(0,o.Lk)("div",{id:"title"},"Welcome to Online Booking!",-1)),(0,o.bF)(Tn,{closeModal:a}),(0,o.bF)(c,{to:"/forgot_password"},{default:(0,o.k6)((()=>i[0]||(i[0]=[(0,o.eW)("Forgot Password")]))),_:1}),(0,o.bF)(c,{to:"/signup"},{default:(0,o.k6)((()=>i[1]||(i[1]=[(0,o.eW)("Create new Account")]))),_:1}),(0,o.Lk)("button",{id:"book",class:"greenBtn",onClick:a}," Book without logging in ")])])])):(0,o.Q3)("",!0)}}});const $n=(0,L.A)(Wn,[["__scopeId","data-v-0854731e"]]);var qn=$n,Un={name:"BookNowParent",components:{Services:he,SelectTime:Ke,FinalPreview:yn,WelcomeModal:qn,BookingConfirmation:Rn},setup(){const e=(0,r.rd)(),n=(0,r.lq)(),t=(0,l.KR)({}),s=(0,l.KR)(1),i=(0,l.KR)(0),a=(0,l.KR)(0),c=(0,l.KR)({}),u=(0,l.KR)(null),d=(0,l.KR)({}),v=(0,o.EW)((()=>Object.keys(c.value).length<1&&Object.keys(t.value).length<1)),p=()=>t.value,m=()=>{e.push(`/booknow/${s.value}`)},h=()=>{s.value++,m()},g=()=>{i.value++},k=()=>{v.value||e.back()},f=(e,n)=>{console.log("date",n),u.value=n,c.value=e,a.value++,h()},b=(e,n)=>{c.value.slots[e].message=n},I=()=>{console.log("clearing form"),c.value={},t.value={},u.value=null},y=(e,n)=>{d.value={name:e,phoneNum:n},h()};return(0,o.wB)((()=>n.params.page),(n=>{if(console.log("navigating: ",n),console.log("formIsEmpty",v.value),s.value!=n)return 1!==n&&0!==n&&v.value?(s.value=1,m(),void e.push("/refresh")):void(s.value=n)})),(0,r.JZ)(((e,n,o)=>{if(e.fullPath.startsWith("/booknow"))return void o();if(0===Object.keys(t.value).length)return void o();const s=confirm("Current selections won't be saved. Proceed to leave?");s?o():o(!1)})),{services:t,page:s,page2trigger:i,page3trigger:a,chain:c,date:u,customer:d,getServices:p,onNavigateNext:h,resetPage2:g,onReturn:k,onSelectChain:f,onInputMessage:b,onSubmit:y,onClearForm:I}}};const Qn=(0,L.A)(Un,[["render",c],["__scopeId","data-v-faca83aa"]]);var Jn=Qn}}]);
//# sourceMappingURL=954.70fa5ae2.js.map